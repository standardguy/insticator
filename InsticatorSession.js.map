{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/js-cookie/src/js.cookie.js","src/constants.ts","src/main.ts","src/session.ts","src/utils.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","factory","extend","result","arguments","key","attributes","decode","s","replace","decodeURIComponent","init","converter","api","set","value","document","path","defaults","expires","Date","toUTCString","JSON","stringify","test","write","encodeURIComponent","String","escape","attributeName","stringifiedAttributes","split","cookie","get","json","jar","cookies","parts","slice","join","name","read","parse","getJSON","remove","withConverter","registeredInModuleLoader","OldCookies","define","amd","window","Cookies","noConflict","now","defaultSession","id","expiration","toString","referrer","campaign","getSession","setDefaultSession","campaignStr","utils_1","getCampaign","constants","firstSession","__assign","js_cookie_1","default","console","log","__importDefault","__importStar","updateSession","session","updateAction","determinUpdateType","campaignUpdates","newSession","newDaySession","resetAtMidnight","currSession","undefined","sessionTimer","timeToExpire","callback","timerDuration","getTime","setTimeout","session_1","Math","floor","random","isExpired","sessionExp","midnight","getFullYear","getMonth","getDate","location","search"],"mappings":"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","file":"InsticatorSession.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/*!\n * JavaScript Cookie v2.2.1\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction decode (s) {\n\t\treturn s.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent);\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api() {}\n\n\t\tfunction set (key, value, attributes) {\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tattributes = extend({\n\t\t\t\tpath: '/'\n\t\t\t}, api.defaults, attributes);\n\n\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\tattributes.expires = new Date(new Date() * 1 + attributes.expires * 864e+5);\n\t\t\t}\n\n\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\ttry {\n\t\t\t\tvar result = JSON.stringify(value);\n\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\tvalue = result;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\n\t\t\tvalue = converter.write ?\n\t\t\t\tconverter.write(value, key) :\n\t\t\t\tencodeURIComponent(String(value))\n\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\n\t\t\tkey = encodeURIComponent(String(key))\n\t\t\t\t.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent)\n\t\t\t\t.replace(/[\\(\\)]/g, escape);\n\n\t\t\tvar stringifiedAttributes = '';\n\t\t\tfor (var attributeName in attributes) {\n\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Considers RFC 6265 section 5.2:\n\t\t\t\t// ...\n\t\t\t\t// 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n\t\t\t\t//     character:\n\t\t\t\t// Consume the characters of the unparsed-attributes up to,\n\t\t\t\t// not including, the first %x3B (\";\") character.\n\t\t\t\t// ...\n\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n\t\t\t}\n\n\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t}\n\n\t\tfunction get (key, json) {\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar jar = {};\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all.\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (!json && cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = decode(parts[0]);\n\t\t\t\t\tcookie = (converter.read || converter)(cookie, name) ||\n\t\t\t\t\t\tdecode(cookie);\n\n\t\t\t\t\tif (json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tjar[name] = cookie;\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn key ? jar[key] : jar;\n\t\t}\n\n\t\tapi.set = set;\n\t\tapi.get = function (key) {\n\t\t\treturn get(key, false /* read as raw */);\n\t\t};\n\t\tapi.getJSON = function (key) {\n\t\t\treturn get(key, true /* read as json */);\n\t\t};\n\t\tapi.remove = function (key, attributes) {\n\t\t\tset(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.defaults = {};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","const cookieDuration = 30 * 60000; // mins * millisecs in a minute\nconst expires = Date.now() + cookieDuration;\n\nconst defaultSession = {\n  id: \"awd34!@a754\",\n  expiration: new Date(expires).toString(),\n  referrer: document.referrer,\n  campaign: \"summer_mailer\",\n};\n\nexport { expires, defaultSession };\n","import { getSession } from \"./session\";\n\ngetSession();\n","import cookie from \"js-cookie\";\nimport * as types from \"./types\";\nimport * as constants from \"./constants\";\nimport {\n  newSession,\n  getCampaign,\n  resetAtMidnight,\n  campaignUpdates,\n  determinUpdateType,\n} from \"./utils\";\n\nconst setDefaultSession = () => {\n  const campaign = getCampaign(document as Document);\n  const campaignStr = campaign ? campaign : constants.defaultSession.campaign;\n  let firstSession = {\n    ...constants.defaultSession,\n    campaign: campaignStr,\n  };\n  cookie.set(\"instiSession\", firstSession);\n  console.log(\"Fist session: %o\", cookie.getJSON(\"instiSession\"));\n};\n\nconst updateSession = (session: types.currSession): void => {\n  let updateAction = \"\";\n  const campaign: string = getCampaign(document as Document);\n\n  switch (determinUpdateType(session, campaign)) {\n    case \"campaignChange\":\n      session = { ...campaignUpdates(session, campaign) };\n      updateAction = \" (Campaign)\";\n      break;\n    case \"expired\":\n      session = { ...session, id: newSession(session.id) };\n      updateAction = \" (Expired)\";\n      break;\n    default:\n      // every session get expiration updated\n      session = {\n        ...session,\n        expiration: new Date(constants.expires).toString(),\n      };\n  }\n\n  cookie.set(\"instiSession\", session);\n  console.log(\n    \"Updated session%s:%o\",\n    updateAction,\n    cookie.getJSON(\"instiSession\")\n  );\n};\n\nconst newDaySession = (session: types.currSession): void => {\n  session = {\n    ...session,\n    id: newSession(session.id),\n    expiration: new Date(constants.expires).toString(),\n  };\n\n  cookie.set(\"instiSession\", session);\n  console.log(\"New day session: %o\", cookie.getJSON(\"instiSession\"));\n  resetAtMidnight();\n};\n\nconst getSession = () => {\n  const currSession = cookie.getJSON(\"instiSession\");\n  resetAtMidnight();\n  if (currSession == undefined) {\n    setDefaultSession();\n  } else {\n    updateSession(currSession);\n  }\n};\n\nexport { getSession, setDefaultSession, updateSession, newDaySession };\n","import cookie from \"js-cookie\";\nimport * as types from \"./types\";\nimport * as constants from \"./constants\";\nimport { newDaySession } from \"./session\";\n\nconst sessionTimer = (timeToExpire: Date, callback: Function) => {\n  const now = new Date();\n  const timerDuration = timeToExpire.getTime() - now.getTime();\n\n  setTimeout(function () {\n    callback(cookie.getJSON(\"instiSession\"));\n  }, timerDuration);\n};\n\nconst resetAtMidnight = () => {\n  const now = new Date();\n  const midnight = new Date(\n    now.getFullYear(),\n    now.getMonth(),\n    now.getDate() + 1, // the next day, ...\n    0,\n    0,\n    0 // ...at 00:00:00 hours\n  );\n  console.log(\"Setting new day timer!!!!\");\n  sessionTimer(midnight, newDaySession);\n};\n\nconst newSession = (id: string): string => {\n  const rando = Math.floor(Math.random() * (10 - 0 + 1)) + 1;\n  return `${id}-${rando}`;\n};\n\nconst getCampaign = (document: Document) => {\n  const campaign = document.location.search.split(\"=\")[1];\n  return campaign && campaign.length > 0 ? campaign : null;\n};\n\nconst isExpired = (sessionExp: string): boolean => {\n  return Date.now() - new Date(sessionExp).getTime() > 0;\n};\n\nconst campaignUpdates = (session: types.currSession, campaign: string) => {\n  session.id = newSession(session.id);\n  session.campaign = campaign;\n  return {\n    ...session,\n    referrer: document.referrer,\n    expiration: new Date(constants.expires).toString(),\n  };\n};\n\nconst determinUpdateType = (\n  session: types.currSession,\n  campaign: string\n): string => {\n  if (campaign !== null && campaign !== session.campaign) {\n    return \"campaignChange\";\n  } else if (isExpired(session.expiration as string)) {\n    return \"expired\";\n  } else {\n    return \"updateExp\";\n  }\n};\n\nexport {\n  sessionTimer,\n  newSession,\n  getCampaign,\n  isExpired,\n  resetAtMidnight,\n  campaignUpdates,\n  determinUpdateType,\n};\n"]}